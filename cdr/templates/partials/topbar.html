{% load static %} {% block header %}
<header id="page-topbar">
  <div class="layout-width">
    <div class="navbar-header">
      <div class="d-flex">
        <!-- LOGO -->
        <div class="navbar-brand-box horizontal-logo">
          <a href="#" class="logo logo-dark">
            <span class="logo-sm">
              <img src="{% static 'images/logo-sm.png'%}" alt="" height="22" />
            </span>
            <span class="logo-lg">
              <img src="{% static 'images/logo-dark.png'%}" alt="" height="17" />
            </span>
          </a>

          <a href="#" class="logo logo-light">
            <span class="logo-sm">
              <img src="{% static 'images/logo-sm.png'%}" alt="" height="22" />
            </span>
            <span class="logo-lg">
              <img src="{% static 'images/logo-light.png'%}" alt="" height="17" />
            </span>
          </a>
        </div>

        <button type="button" class="btn btn-sm px-3 fs-16 header-item vertical-menu-btn topnav-hamburger material-shadow-none" id="topnav-hamburger-icon">
          <span class="hamburger-icon">
            <span></span>
            <span></span>
            <span></span>
          </span>
        </button>

        <!-- App Search-->
        <form class="app-search d-none d-md-block" id="extensionSearchForm" onsubmit="return handleExtensionSearch(event)">
          <div class="position-relative">
            <input type="text" class="form-control" placeholder="Search extension..." autocomplete="off" id="search-options" value="" />
            <span class="mdi mdi-magnify search-widget-icon"></span>
            <span class="mdi mdi-close-circle search-widget-icon search-widget-icon-close d-none" id="search-close-options"></span>
          </div>
          <!-- Remove or comment out the dropdown menu if not needed for extension search -->
        </form>
      </div>

      <div class="d-flex align-items-center">
        <div class="dropdown d-md-none topbar-head-dropdown header-item">
          <button type="button" class="btn btn-icon btn-topbar material-shadow-none btn-ghost-secondary rounded-circle" id="page-header-search-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <i class="bx bx-search fs-22"></i>
          </button>
          <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-search-dropdown">
            <form class="p-3">
              <div class="form-group m-0">
                <div class="input-group">
                  <input type="text" class="form-control" placeholder="Search ..." aria-label="Recipient's username" />
                  <button class="btn btn-primary" type="submit"><i class="mdi mdi-magnify"></i></button>
                </div>
              </div>
            </form>
          </div>
        </div>

        <div class="dropdown ms-1 topbar-head-dropdown header-item">
          <button type="button" class="btn btn-icon btn-topbar material-shadow-none btn-ghost-secondary rounded-circle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <img id="header-lang-img" src="{% static 'images/flags/us.svg'%}" alt="Header Language" height="20" class="rounded" />
          </button>
          <div class="dropdown-menu dropdown-menu-end">
            <!-- item-->
            <a href="javascript:void(0);" class="dropdown-item notify-item language py-2" data-lang="en" title="English">
              <img src="{% static 'images/flags/us.svg'%}" alt="user-image" class="me-2 rounded" height="18" />
              <span class="align-middle">English</span>
            </a>

            <!-- <a href="javascript:void(0);" class="dropdown-item notify-item language" data-lang="ar" title="Arabic">
                                <img src="{% static 'images/flags/ae.svg' %}" alt="user-image" class="me-2 rounded" height="18">
                                <span class="align-middle">Arabic</span>
                            </a> -->
          </div>
        </div>

        <div class="ms-1 header-item d-none d-sm-flex">
          <button type="button" class="btn btn-icon btn-topbar material-shadow-none btn-ghost-secondary rounded-circle" data-toggle="fullscreen">
            <i class="bx bx-fullscreen fs-22"></i>
          </button>
        </div>

        <div class="ms-1 header-item d-none d-sm-flex">
          <button type="button" class="btn btn-icon btn-topbar material-shadow-none btn-ghost-secondary rounded-circle light-dark-mode">
            <i class="bx bx-moon fs-22"></i>
          </button>
        </div>

        <div class="dropdown ms-sm-3 header-item topbar-user">
          <button type="button" class="btn material-shadow-none" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <span class="d-flex align-items-center">
              <svg class="rounded-circle header-profile-user" width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
                <rect width="32" height="32" fill="#007bff" />
                <text x="50%" y="50%" font-family="Arial, sans-serif" font-size="14" fill="white" text-anchor="middle" dy=".3em">SM</text>
              </svg>
              <span class="text-start ms-xl-2">
                <span class="d-none d-xl-inline-block ms-1 fw-medium user-name-text">Smasco</span>
                <span class="d-none d-xl-block ms-1 fs-12 user-name-sub-text">KSA</span>
              </span>
            </span>
          </button>
          <div class="dropdown-menu dropdown-menu-end">
            <!-- item-->
            <h6 class="dropdown-header">Welcome SMASCO!</h6>
            <a class="dropdown-item" href="#"><i class="mdi mdi-account-circle text-muted fs-16 align-middle me-1"></i> <span class="align-middle">Profile</span></a>
            <a class="dropdown-item" href="#"><i class="mdi mdi-message-text-outline text-muted fs-16 align-middle me-1"></i> <span class="align-middle">Messages</span></a>

            <a class="dropdown-item" href="#"><i class="mdi mdi-lifebuoy text-muted fs-16 align-middle me-1"></i> <span class="align-middle">Help</span></a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="#"
              ><i class="mdi mdi-wallet text-muted fs-16 align-middle me-1"></i> <span class="align-middle">Balance : <b>SAR 0</b></span></a
            >
            <a class="dropdown-item" href="#"><span class="badge bg-success-subtle text-success mt-1 float-end">New</span><i class="mdi mdi-cog-outline text-muted fs-16 align-middle me-1"></i> <span class="align-middle">Settings</span></a>

            {% if user.is_authenticated %} {% if user.has_usable_password %}
            <a class="dropdown-item" href="#">
              <i class="mdi mdi-key text-muted fs-16 align-middle me-1"></i>
              <span class="align-middle" data-key="t-change-password">Change Password</span>
            </a>
            {% else %}
            <a class="dropdown-item" href="#">
              <i class="mdi mdi-key text-muted fs-16 align-middle me-1"></i>
              <span class="align-middle" data-key="t-set-password">Set Password</span>
            </a>
            {% endif %}
            <a class="dropdown-item" href="{% url 'accounts:logout' %}">
              <i class="mdi mdi-logout text-muted fs-16 align-middle me-1"></i>
              <span class="align-middle" data-key="t-logout">Logout</span>
            </a>

            {% endif %}
          </div>
        </div>
        {% if messages %} {% for message in messages %}
        <input type="hidden" id="login-msg" value="{{message}}" />

        <button type="button" class="btn btn-primary" id="liveToastBtn" hidden></button>
        <div class="position-fixed top-0 end-0 p-3" style="z-index: 11">
          <div class="toast align-items-right text-white bg-primary border-0" id="toast-message" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
              <div class="toast-body">{{message}}</div>
              <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
          </div>
        </div>

        {% endfor %} {% endif %}
      </div>
    </div>
  </div>
</header>
<!-- removeNotificationModal -->
<div id="removeNotificationModal" class="modal fade zoomIn" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="NotificationModalbtn-close"></button>
      </div>
      <div class="modal-body">
        <div class="mt-2 text-center">
          <lord-icon src="https://cdn.lordicon.com/gsqxdxog.json" trigger="loop" colors="primary:#f7b84b,secondary:#f06548" style="width: 100px; height: 100px"></lord-icon>
          <div class="mt-4 pt-2 fs-15 mx-4 mx-sm-5">
            <h4>Are you sure ?</h4>
            <p class="text-muted mx-4 mb-0">Are you sure you want to remove this Notification ?</p>
          </div>
        </div>
        <div class="d-flex gap-2 justify-content-center mt-4 mb-2">
          <button type="button" class="btn w-sm btn-light" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn w-sm btn-danger" id="delete-notification">Yes, Delete It!</button>
        </div>
      </div>
    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
{% endblock header %}

<script>
  function handleExtensionSearch(event) {
    event.preventDefault();
    const searchInput = document.getElementById("search-options");
    const extension = searchInput.value.trim();

    if (/^\d{4}$/.test(extension)) {
      // If input is a 4-digit number, redirect to caller_calls view
      window.location.href = `/caller-calls/${extension}/`;
    } else {
      // Optional: Show an error message for invalid input
      alert("Please enter a valid 4-digit extension.");
    }
    return false;
  }

  // Optional: Clear search input when close icon is clicked
  document.getElementById("search-close-options").addEventListener("click", function () {
    document.getElementById("search-options").value = "";
    this.classList.add("d-none");
  });

  // Optional: Show/hide close icon based on input
  document.getElementById("search-options").addEventListener("input", function () {
    const closeIcon = document.getElementById("search-close-options");
    if (this.value) {
      closeIcon.classList.remove("d-none");
    } else {
      closeIcon.classList.add("d-none");
    }
  });
</script>
